<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="海光,超线程,ADM,Zen,hygon," />





  <link rel="alternate" href="/atom.xml" title="plantegg" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="AMD Zen CPU 架构前言本文先介绍AMD Zen 架构，结合前一篇文章《CPU的生产和概念》一起来看效果会更好，在CPU的生产和概念中主要是以Intel方案来介绍，CPU的生产和概念中的 多核和多个CPU方案2 就是指的AMD Zen2架构。 Zen1 和 Intel 还比较像，只是一个CPU会封装多个小的Die来得到多核能力，导致NUMA node比较多。 AMD 从Zen2开始架构有了">
<meta name="keywords" content="海光,超线程,ADM,Zen,hygon">
<meta property="og:type" content="article">
<meta property="og:title" content="AMD Zen CPU 架构以及不同CPU性能大PK">
<meta property="og:url" content="https://plantegg.github.io/2021/08/13/AMD_Zen_CPU架构/index.html">
<meta property="og:site_name" content="plantegg">
<meta property="og:description" content="AMD Zen CPU 架构前言本文先介绍AMD Zen 架构，结合前一篇文章《CPU的生产和概念》一起来看效果会更好，在CPU的生产和概念中主要是以Intel方案来介绍，CPU的生产和概念中的 多核和多个CPU方案2 就是指的AMD Zen2架构。 Zen1 和 Intel 还比较像，只是一个CPU会封装多个小的Die来得到多核能力，导致NUMA node比较多。 AMD 从Zen2开始架构有了">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/image-20220331120118117.png">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/amd-rome-naples-chiplets.jpg">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/AMD-Packaging-to-X3D-FAD-2020.jpg">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/image-20220721174306194.png">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/image-20210812204437220.png">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/image-20210813085044786.png">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/zeppelin_face_down2.png">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/515px-zen-1zep.svg.png">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/512px-zen-4zep.svg.png">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/450px-amd_zen_ccx.png">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/700px-amd_zen_ccx_2_annotated.png">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/image-20210813085044786.png">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/800px-AMD_Naples_SoC.svg.png">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/AMD-EPYC-Infinity-Fabric-Topology-Mapping.webp">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/image-20210602165525641.png">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/1624282522149-35de1452-3e8d-4632-a53a-b99f1ed39a21.png">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/AMD_Rome_layout-617x486.jpg">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/amd-rome-feature-chart.jpg">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/500px-AMD_Zen_2_CCD.jpg">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/4f71c923-4601-4d98-a311-91da8996c526.png">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/amd-rome-epyc-zen1-zen2.jpg">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/image-20210813091455662.png">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/OctalNUMA_575px.png">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/image-20220402101632476.png">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/400px-alder_lake_die_2.png">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/image-20211205130348832.png">
<meta property="og:image" content="https://plantegg.github.io/images/951413iMgBlog/v2-4a587237e30986b36c5657761c31ae21_r.jpg">
<meta property="og:updated_time" content="2022-09-22T01:07:01.470Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="AMD Zen CPU 架构以及不同CPU性能大PK">
<meta name="twitter:description" content="AMD Zen CPU 架构前言本文先介绍AMD Zen 架构，结合前一篇文章《CPU的生产和概念》一起来看效果会更好，在CPU的生产和概念中主要是以Intel方案来介绍，CPU的生产和概念中的 多核和多个CPU方案2 就是指的AMD Zen2架构。 Zen1 和 Intel 还比较像，只是一个CPU会封装多个小的Die来得到多核能力，导致NUMA node比较多。 AMD 从Zen2开始架构有了">
<meta name="twitter:image" content="https://plantegg.github.io/images/951413iMgBlog/image-20220331120118117.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://plantegg.github.io/2021/08/13/AMD_Zen_CPU架构/"/>





  <title>AMD Zen CPU 架构以及不同CPU性能大PK | plantegg</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  















  
  
    
  

  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta custom-logo">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">plantegg</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">java tcp mysql performance network docker Linux</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-categories"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://plantegg.github.io/2021/08/13/AMD_Zen_CPU架构/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="twitter @plantegg">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="plantegg">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">AMD Zen CPU 架构以及不同CPU性能大PK</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-08-13T17:30:03+08:00">
                2021-08-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CPU/" itemprop="url" rel="index">
                    <span itemprop="name">CPU</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="AMD-Zen-CPU-架构"><a href="#AMD-Zen-CPU-架构" class="headerlink" title="AMD Zen CPU 架构"></a>AMD Zen CPU 架构</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文先介绍AMD Zen 架构，结合前一篇文章《<a href="https://www.atatech.org/articles/211563" target="_blank" rel="external">CPU的生产和概念</a>》一起来看效果会更好，在<a href="https://www.atatech.org/articles/211563" target="_blank" rel="external">CPU的生产和概念</a>中主要是以Intel方案来介绍，CPU的生产和概念中的 多核和多个CPU方案2 就是指的AMD Zen2架构。</p>
<p>Zen1 和 Intel 还比较像，只是一个CPU会封装多个小的Die来得到多核能力，导致NUMA node比较多。</p>
<p>AMD 从Zen2开始架构有了比较大的变化，Zen2架构改动比较大，将IO从Core Die中抽离出来，形成一个专门的IO Die，这个IO Die可以用上一代的工艺实现来提升成品率降低成本。剩下的core Die 专注在core和cache的实现上，同时可以通过最新一代的工艺来提升性能。并且在一个CPU上封装一个 IO Die + 8个 core Die这样一块CPU做到像Intel一样就是一个大NUMA，但是成本低了很多，也许在云计算时代这么搞比较合适。当然会被大家笑话为胶水核（用胶水把多个Die拼在一起），性能肯定是不如一个大Die好，但是挡不住便宜啊。这估计就是大家所说的 <strong>AMD YES！</strong>吧</p>
<p>比如Core Die用7nm工艺，IO Die用14nm工艺，一块CPU封装8个Core Die+1个IO Die的话既能得到一个多核的CPU成本有非常低，参考 《CPU的生产和概念》中的良品率和成品部分。</p>
<p>介绍完AMD架构后，会拿海光7280这块CPU（实际是OEM的AMD Zen1 架构，一块芯片封装4个die）和 Intel的CPU用MySQL 来对比一下实际性能。</p>
<p>网上Intel CPU架构、技术参数等各种资料还是很丰富的，但是AMD EPYC就比较少了，所以先来学习一下EPYC的架构特点。</p>
<p><img src="/images/951413iMgBlog/image-20220331120118117.png" alt="image-20220331120118117"></p>
<h2 id="AMD-EPYC-CPU演进路线"><a href="#AMD-EPYC-CPU演进路线" class="headerlink" title="AMD EPYC CPU演进路线"></a>AMD EPYC CPU演进路线</h2><p><img src="/images/951413iMgBlog/amd-rome-naples-chiplets.jpg" alt="img"></p>
<p>后面会针对 第二代的 EPYC来做一个对比测试。</p>
<p><img src="/images/951413iMgBlog/AMD-Packaging-to-X3D-FAD-2020.jpg" alt="AMD Accelerated Computing FAD 2020"></p>
<p> AMD EPYC CPU Families:</p>
<table>
<thead>
<tr>
<th style="text-align:left">Family Name</th>
<th style="text-align:left">AMD EPYC Naples</th>
<th style="text-align:left">AMD EPYC Rome</th>
<th style="text-align:left">AMD EPYC Milan</th>
<th style="text-align:left">AMD EPYC Genoa</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Family Branding</td>
<td style="text-align:left">EPYC 7001</td>
<td style="text-align:left">EPYC 7002</td>
<td style="text-align:left">EPYC 7003</td>
<td style="text-align:left">EPYC 7004?</td>
</tr>
<tr>
<td style="text-align:left">Family Launch</td>
<td style="text-align:left">2017</td>
<td style="text-align:left">2019</td>
<td style="text-align:left">2021</td>
<td style="text-align:left">2022</td>
</tr>
<tr>
<td style="text-align:left">CPU Architecture</td>
<td style="text-align:left">Zen 1</td>
<td style="text-align:left">Zen 2</td>
<td style="text-align:left">Zen 3</td>
<td style="text-align:left">Zen 4</td>
</tr>
<tr>
<td style="text-align:left">Process Node</td>
<td style="text-align:left">14nm GloFo</td>
<td style="text-align:left">7nm TSMC</td>
<td style="text-align:left">7nm TSMC</td>
<td style="text-align:left">5nm TSMC</td>
</tr>
<tr>
<td style="text-align:left">Platform Name</td>
<td style="text-align:left">SP3</td>
<td style="text-align:left">SP3</td>
<td style="text-align:left">SP3</td>
<td style="text-align:left">SP5</td>
</tr>
<tr>
<td style="text-align:left">Socket</td>
<td style="text-align:left">LGA 4094</td>
<td style="text-align:left">LGA 4094</td>
<td style="text-align:left">LGA 4094</td>
<td style="text-align:left">LGA 6096</td>
</tr>
<tr>
<td style="text-align:left">Max Core Count</td>
<td style="text-align:left">32</td>
<td style="text-align:left">64</td>
<td style="text-align:left">64</td>
<td style="text-align:left">96</td>
</tr>
<tr>
<td style="text-align:left">Max Thread Count</td>
<td style="text-align:left">64</td>
<td style="text-align:left">128</td>
<td style="text-align:left">128</td>
<td style="text-align:left">192</td>
</tr>
<tr>
<td style="text-align:left">Max L3 Cache</td>
<td style="text-align:left">64 MB</td>
<td style="text-align:left">256 MB</td>
<td style="text-align:left">256 MB</td>
<td style="text-align:left">384 MB?</td>
</tr>
<tr>
<td style="text-align:left">Chiplet Design</td>
<td style="text-align:left">4 CCD’s (2 CCX’s per CCD)，4 Die</td>
<td style="text-align:left">8 CCD’s (2 CCX’s per CCD) + 1 IOD ，9 Die</td>
<td style="text-align:left">8 CCD’s (1 CCX per CCD) + 1 IOD</td>
<td style="text-align:left">12 CCD’s (1 CCX per CCD) + 1 IOD</td>
</tr>
<tr>
<td style="text-align:left">Memory Support</td>
<td style="text-align:left">DDR4-2666</td>
<td style="text-align:left">DDR4-3200</td>
<td style="text-align:left">DDR4-3200</td>
<td style="text-align:left">DDR5-5200</td>
</tr>
<tr>
<td style="text-align:left">Memory Channels</td>
<td style="text-align:left">8 Channel</td>
<td style="text-align:left">8 Channel</td>
<td style="text-align:left">8 Channel</td>
<td style="text-align:left">12 Channel</td>
</tr>
<tr>
<td style="text-align:left">PCIe Gen Support</td>
<td style="text-align:left">64 Gen 3</td>
<td style="text-align:left">128 Gen 4</td>
<td style="text-align:left">128 Gen 4</td>
<td style="text-align:left">128 Gen 5</td>
</tr>
<tr>
<td style="text-align:left">TDP Range</td>
<td style="text-align:left">200W</td>
<td style="text-align:left">280W</td>
<td style="text-align:left">280W</td>
<td style="text-align:left">320W (cTDP 400W)</td>
</tr>
</tbody>
</table>
<p>命名规范：</p>
<p><img src="/images/951413iMgBlog/image-20220721174306194.png" alt="image-20220721174306194" style="zoom:70%;"></p>
<h2 id="Zen1"><a href="#Zen1" class="headerlink" title="Zen1"></a>Zen1</h2><p>hygon 5280封装后类似下图(一块CPU封装了2个Die，还有封装4个Die的，core更多更贵而已)</p>
<p><img src="/images/951413iMgBlog/image-20210812204437220.png" alt="image-20210812204437220" style="zoom:50%;"></p>
<p>或者4个Die封装在一起</p>
<p><img src="/images/951413iMgBlog/image-20210813085044786.png" alt="image-20210813085044786"></p>
<h3 id="Zen1-Die"><a href="#Zen1-Die" class="headerlink" title="Zen1 Die"></a>Zen1 Die</h3><p>下面这块Die集成了两个CCX（每个CCX四个物理core), 同时还有IO接口</p>
<p><img src="/images/951413iMgBlog/zeppelin_face_down2.png" alt="Блоки CCX"></p>
<p><img src="/images/951413iMgBlog/515px-zen-1zep.svg.png" alt="img"></p>
<p>Quad-Zeppelin Configuration, as found in <a href="https://en.wikichip.org/wiki/amd/epyc" target="_blank" rel="external">EPYC</a>. </p>
<p><img src="/images/951413iMgBlog/512px-zen-4zep.svg.png" alt="img"></p>
<h3 id="Zen-CPU-Complex-CCX"><a href="#Zen-CPU-Complex-CCX" class="headerlink" title="Zen CPU Complex(CCX)"></a>Zen CPU Complex(CCX)</h3><p>hygon 5280使用这个结构， There are 4 cores per CCX and 2 CCXs per die for 8 cores.</p>
<ul>
<li>44 mm² area</li>
<li>L3 8 MiB; 16 mm²</li>
<li>1,400,000,000 transistors</li>
</ul>
<p><img src="/images/951413iMgBlog/450px-amd_zen_ccx.png" alt="amd zen ccx.png"></p>
<p><img src="/images/951413iMgBlog/700px-amd_zen_ccx_2_annotated.png" alt="amd zen ccx 2"></p>
<h3 id="封装后的Zen1（4Die）"><a href="#封装后的Zen1（4Die）" class="headerlink" title="封装后的Zen1（4Die）"></a>封装后的Zen1（4Die）</h3><p><img src="/images/951413iMgBlog/image-20210813085044786.png" alt="image-20210813085044786"></p>
<p>4个Die的内部关系</p>
<p><img src="/images/951413iMgBlog/800px-AMD_Naples_SoC.svg.png" alt="AMD Naples SoC.svg"></p>
<p>详实数据和结构</p>
<p><img src="/images/951413iMgBlog/AMD-EPYC-Infinity-Fabric-Topology-Mapping.webp" alt="Топология процессора"></p>
<h2 id="Zen2-Rome"><a href="#Zen2-Rome" class="headerlink" title="Zen2 Rome"></a><a href="https://en.wikichip.org/wiki/amd/microarchitectures/zen_2" target="_blank" rel="external">Zen2 Rome</a></h2><p>Zen2开始最大的变化就是将IO从Core Die中抽离出来，形成一个专门的IO Die。封装后如下图：</p>
<p><img src="/images/951413iMgBlog/image-20210602165525641.png" alt="AMD Rome package with card" style="zoom:50%;"></p>
<p>以上结构的CPU在2路服务器下的内部结构：</p>
<p><img src="/images/951413iMgBlog/1624282522149-35de1452-3e8d-4632-a53a-b99f1ed39a21.png" alt="img"></p>
<p>跨socket的内存访问的数据流跟互联有关，如上图标示，比如从左边的CCD0到右边的CCD0的内存，大概需要经过10跳。</p>
<table>
<thead>
<tr>
<th></th>
<th>node0</th>
<th>node1</th>
<th>node2</th>
<th>node3</th>
<th>node4</th>
<th>node5</th>
<th>node6</th>
<th>node7</th>
</tr>
</thead>
<tbody>
<tr>
<td>node0</td>
<td>89.67</td>
<td>99.357</td>
<td>108.11</td>
<td>110.54</td>
<td>181.85</td>
<td>187.71</td>
<td>179.507</td>
<td>179.463</td>
</tr>
<tr>
<td>node1</td>
<td></td>
<td>90.983</td>
<td>111.65</td>
<td>106.11</td>
<td>188.77</td>
<td>194.7</td>
<td>188.179</td>
<td>189.512</td>
</tr>
<tr>
<td>node2</td>
<td></td>
<td></td>
<td>91.2</td>
<td>98.272</td>
<td>180.95</td>
<td>190.53</td>
<td>184.865</td>
<td>186.088</td>
</tr>
<tr>
<td>node3</td>
<td></td>
<td></td>
<td></td>
<td>89.971</td>
<td>186.81</td>
<td>193.43</td>
<td>192.459</td>
<td>192.615</td>
</tr>
<tr>
<td>node4</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>89.566</td>
<td>97.943</td>
<td>108.19</td>
<td>109.942</td>
</tr>
<tr>
<td>node5</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>90.927</td>
<td>111.123</td>
<td>108.046</td>
</tr>
<tr>
<td>node6</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>91.212</td>
<td>103.719</td>
</tr>
<tr>
<td>node7</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>89.692</td>
</tr>
</tbody>
</table>
<p>上面表格是3 xGMI互联的情况下，测试出来的访存时延，可以看到在某些node间访存时延会有一些的突增，不够均匀，比如node1到node 5、node2到node5；上述latency跨socket如果用默认BIOS值在280左右</p>
<p>以下表格是厂商默认值和优化值对比（用优化值能将latency从280下降到180左右）：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>可选项</th>
<th>默认值 （milan:V260 rome:V26.02）</th>
<th>优化值</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>xGMI Link Width Control</td>
<td>Manual/Auto</td>
<td>Auto</td>
<td>Manual</td>
<td></td>
</tr>
<tr>
<td>xGMI Force Link Width Control</td>
<td>Unforce/Force</td>
<td>Unforce</td>
<td>Force</td>
<td></td>
</tr>
<tr>
<td>xGMI Force Link Width</td>
<td>0/1/2</td>
<td>2</td>
<td>2</td>
<td>2 = Force xGMI link width to x16</td>
</tr>
<tr>
<td>3-link xGMI max speed</td>
<td>[00]6.4Gbps     ……   [0A]16Gbps   ……[13]25Gbps     *[FF]Auto</td>
<td>Auto</td>
<td>16Gbps</td>
<td>IEC的rome和milan都是16Gbs，其他产品要与硬件确认</td>
</tr>
</tbody>
</table>
<p>另外发现启用透明大页后测试内存时延能降低20%（通过perf发现没开THP的tlb miss很高）</p>
<p><img src="/images/951413iMgBlog/AMD_Rome_layout-617x486.jpg" alt="AMD Rome layout"></p>
<p><img src="/images/951413iMgBlog/amd-rome-feature-chart.jpg" alt="img"></p>
<h3 id="Zen2-Core-Complex-Die"><a href="#Zen2-Core-Complex-Die" class="headerlink" title="Zen2 Core Complex Die"></a>Zen2 Core Complex Die</h3><ul>
<li>TSMC <a href="https://en.wikichip.org/wiki/N7" target="_blank" rel="external">7-nanometer process</a></li>
<li>13 metal layers[<a href="https://en.wikichip.org/wiki/amd/microarchitectures/zen_2#cite_note-isscc2020j-zen2-1" target="_blank" rel="external">1</a>]</li>
<li>3,800,000,000 transistors[<a href="https://en.wikichip.org/wiki/amd/microarchitectures/zen_2#cite_note-isscc2020p-chiplet-2" target="_blank" rel="external">2</a>]</li>
<li>Die size: 74 mm²</li>
<li>CCX size: 31.3 mm²， 4core per CCX // 16M L3 perf CCX</li>
<li>2 × 16 MiB L3 cache: 2 × 16.8 mm² (estimated) // 中间蓝色部分是L3 16M，一个Die封装两个CCX的情况下</li>
</ul>
<p><img src="/images/951413iMgBlog/500px-AMD_Zen_2_CCD.jpg" alt="AMD Zen 2 CCD.jpg"></p>
<p><img src="/images/951413iMgBlog/4f71c923-4601-4d98-a311-91da8996c526.png" alt="img"></p>
<p>在Zen2/Rome架构中，一个CCD由两个CCX构成，一个CCX包含4个物理核，共享16MB的L3 cache。</p>
<p>在Zen3/Milan架构中，抛弃了两个CCX组成一个CCD的概念，一个CCD直接由8个物理核构成，共享整个Die上的32MB L3 cache。</p>
<h2 id="Zen1-VS-Zen2"><a href="#Zen1-VS-Zen2" class="headerlink" title="Zen1 VS Zen2"></a>Zen1 VS Zen2</h2><p>Here is what the Naples and Rome packages look like from the outside:</p>
<p><img src="/images/951413iMgBlog/amd-rome-epyc-zen1-zen2.jpg" alt="img"></p>
<p>numa</p>
<p><img src="/images/951413iMgBlog/image-20210813091455662.png" alt="image-20210813091455662"></p>
<p>zen1 numa distance:</p>
<p><img src="/images/951413iMgBlog/OctalNUMA_575px.png" alt="img"></p>
<p>hygon numa distance:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"># numactl -H  //Zen1 hygon 7280  2 socket enable die interleaving</div><div class="line">available: 2 nodes (0-1)</div><div class="line">node 0 cpus: 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95</div><div class="line">node 0 size: 257578 MB</div><div class="line">node 0 free: 115387 MB</div><div class="line">node 1 cpus: 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127</div><div class="line">node 1 size: 257005 MB</div><div class="line">node 1 free: 221031 MB</div><div class="line">node distances:</div><div class="line">node   0   1</div><div class="line">  0:  10  22</div><div class="line">  1:  22  10</div><div class="line">  </div><div class="line">  #numactl -H //Zen1 hygon 5280  2 socket disable die interleaving</div><div class="line">available: 4 nodes (0-3)</div><div class="line">node 0 cpus: 0 1 2 3 4 5 6 7 32 33 34 35 36 37 38 39</div><div class="line">node 0 size: 128854 MB</div><div class="line">node 0 free: 89350 MB</div><div class="line">node 1 cpus: 8 9 10 11 12 13 14 15 40 41 42 43 44 45 46 47</div><div class="line">node 1 size: 129019 MB</div><div class="line">node 1 free: 89326 MB</div><div class="line">node 2 cpus: 16 17 18 19 20 21 22 23 48 49 50 51 52 53 54 55</div><div class="line">node 2 size: 128965 MB</div><div class="line">node 2 free: 86542 MB</div><div class="line">node 3 cpus: 24 25 26 27 28 29 30 31 56 57 58 59 60 61 62 63</div><div class="line">node 3 size: 129020 MB</div><div class="line">node 3 free: 98227 MB</div><div class="line">node distances:</div><div class="line">node   0   1   2   3</div><div class="line">  0:  10  16  28  22</div><div class="line">  1:  16  10  22  28</div><div class="line">  2:  28  22  10  16</div><div class="line">  3:  22  28  16  10</div></pre></td></tr></table></figure>
<p>看完这些结构上的原理，让我们实际来看看AMD的性能怎么样。</p>
<h2 id="hygon-7280-PCM数据"><a href="#hygon-7280-PCM数据" class="headerlink" title="hygon 7280 PCM数据"></a>hygon 7280 PCM数据</h2><p>hygon pcm(performance counter monitor) 工具由芯片公司提供</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">[root@hygon3 16:58 /root/PCM]</div><div class="line"><span class="meta">#</span>./pcm.x -r -topdown -i=1 -nc -ns -l2</div><div class="line"></div><div class="line"> Processor Counter Monitor  (2019-08-21 17:07:31 +0800 ID=378f2fc)</div><div class="line"></div><div class="line">Number of physical cores: 64</div><div class="line">Number of logical cores: 128</div><div class="line">Number of online logical cores: 128</div><div class="line">Threads (logical cores) per physical core: 2</div><div class="line">Num sockets: 2</div><div class="line">Physical cores per socket: 32</div><div class="line">Core PMU (perfmon) version: 3</div><div class="line">Number of core PMU generic (programmable) counters: 6</div><div class="line">Width of generic (programmable) counters: 64 bits</div><div class="line">Ccxs per Node: 8</div><div class="line">Logical cores per Ccx: 8</div><div class="line">Physical Cores per Ccx: 4</div><div class="line">Nodes per socket: 4</div><div class="line">Number of core PMU fixed counters: 0</div><div class="line">Width of fixed counters: 0 bits</div><div class="line">Nominal core frequency: 2000000000 Hz</div><div class="line">Package thermal spec power: -1 Watt; Package minimum power: -1 Watt; Package maximum power: -1 Watt;</div><div class="line"></div><div class="line"> Resetting PMU configuration</div><div class="line"> Zeroed PMU registers</div><div class="line"></div><div class="line">Detected Hygon C86 7280 32-core Processor  "Hygon(r) microarchitecture codename DHYANA" stepping 1</div><div class="line"></div><div class="line"> EXEC  : instructions per nominal CPU cycle</div><div class="line"> IPC   : instructions per CPU cycle</div><div class="line"> FREQ  : relation to nominal CPU frequency='unhalted clock ticks'/'invariant timer ticks' (includes Intel Turbo Boost)</div><div class="line"> AFREQ : relation to nominal CPU frequency while in active state (not in power-saving C state)='unhalted clock ticks'/'invariant timer ticks while in C0-state'  (includes Intel Turbo Boost)</div><div class="line"> L3MISS: L3 (read) cache misses</div><div class="line"> L3MPKI: L3 misses per kilo instructions</div><div class="line"> L3HIT : L3 (read) cache hit ratio (0.00-1.00)</div><div class="line"> L2DMISS:L2 data cache misses</div><div class="line"> L2DHIT :L2 data cache hit ratio (0.00-1.00)</div><div class="line"> L2DMPKI:number of L2 data cache misses per kilo instruction</div><div class="line"> L2IMISS:L2 instruction cache misses</div><div class="line"> L2IHIT :L2 instructoon cache hit ratio (0.00-1.00)</div><div class="line"> L2IMPKI:number of L2  instruction cache misses per kilo instruction</div><div class="line"> L2MPKI :number of both L2 instruction and data cache misses per kilo instruction</div><div class="line"></div><div class="line"> Core (SKT) |  EXEC  |   IPC  |  FREQ  |  AFREQ | L2DMISS| L2DHIT | L2DMPKI| L2IMISS| L2IHIT | L2IMPKI| L2MPKI | L3MISS | L3MPKI |  L3HIT | TEMP</div><div class="line"></div><div class="line">---------------------------------------------------------------------------------------------------------------</div><div class="line"> TOTAL  *     1.29     1.20     1.08     1.00     12 M     0.73     0.04     10 M     0.87     0.03     0.07     19 M     0.00     0.55     N/A</div><div class="line"></div><div class="line"> Instructions retired:  336 G ; Active cycles:  281 G ; Time (TSC): 2082 Mticks ; C0 (active,non-halted) core residency: 107.90 %</div><div class="line"></div><div class="line"></div><div class="line"> PHYSICAL CORE IPC                 : 2.39 =&gt; corresponds to 34.14 % utilization for cores in active state</div><div class="line"> Instructions per nominal CPU cycle: 2.58 =&gt; corresponds to 36.84 % core utilization over time interval</div><div class="line">---------------------------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">Cleaning up</div><div class="line"> Zeroed PMU registers</div></pre></td></tr></table></figure>
<p>在本地启动benchmarksql压力，并将进程绑定到0-8core，然后采集到数据：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span>./pcm.x -r -topdown -i=1 -l2</div><div class="line"></div><div class="line"> Processor Counter Monitor  (2019-08-21 17:07:31 +0800 ID=378f2fc)</div><div class="line"></div><div class="line">Number of physical cores: 64</div><div class="line">Number of logical cores: 128</div><div class="line">Number of online logical cores: 128</div><div class="line">Threads (logical cores) per physical core: 2</div><div class="line">Num sockets: 2</div><div class="line">Physical cores per socket: 32</div><div class="line">Core PMU (perfmon) version: 3</div><div class="line">Number of core PMU generic (programmable) counters: 6</div><div class="line">Width of generic (programmable) counters: 64 bits</div><div class="line">Ccxs per Node: 8</div><div class="line">Logical cores per Ccx: 8</div><div class="line">Physical Cores per Ccx: 4</div><div class="line">Nodes per socket: 4</div><div class="line">Number of core PMU fixed counters: 0</div><div class="line">Width of fixed counters: 0 bits</div><div class="line">Nominal core frequency: 2000000000 Hz</div><div class="line">Package thermal spec power: -1 Watt; Package minimum power: -1 Watt; Package maximum power: -1 Watt;</div><div class="line"></div><div class="line"> Resetting PMU configuration</div><div class="line"> Zeroed PMU registers</div><div class="line"></div><div class="line">Detected Hygon C86 7280 32-core Processor  "Hygon(r) microarchitecture codename DHYANA" stepping 1</div><div class="line"></div><div class="line"> EXEC  : instructions per nominal CPU cycle</div><div class="line"> IPC   : instructions per CPU cycle</div><div class="line"> FREQ  : relation to nominal CPU frequency='unhalted clock ticks'/'invariant timer ticks' (includes Intel Turbo Boost)</div><div class="line"> AFREQ : relation to nominal CPU frequency while in active state (not in power-saving C state)='unhalted clock ticks'/'invariant timer ticks while in C0-state'  (includes Intel Turbo Boost)</div><div class="line"> L3MISS: L3 (read) cache misses</div><div class="line"> L3MPKI: L3 misses per kilo instructions</div><div class="line"> L3HIT : L3 (read) cache hit ratio (0.00-1.00)</div><div class="line"> L2DMISS:L2 data cache misses</div><div class="line"> L2DHIT :L2 data cache hit ratio (0.00-1.00)</div><div class="line"> L2DMPKI:number of L2 data cache misses per kilo instruction</div><div class="line"> L2IMISS:L2 instruction cache misses</div><div class="line"> L2IHIT :L2 instructoon cache hit ratio (0.00-1.00)</div><div class="line"> L2IMPKI:number of L2  instruction cache misses per kilo instruction</div><div class="line"> L2MPKI :number of both L2 instruction and data cache misses per kilo instruction</div><div class="line"></div><div class="line"> Core (SKT) |  EXEC  |   IPC  |  FREQ  |  AFREQ | L2DMISS| L2DHIT | L2DMPKI| L2IMISS| L2IHIT | L2IMPKI| L2MPKI | L3MISS | L3MPKI |  L3HIT | TEMP</div><div class="line"></div><div class="line">   0    0     1.34     1.26     1.06     1.00   8901 K     0.72     3.15     15 M     0.68     5.43     8.58     71 M     4.00     0.60      N/A</div><div class="line">   1    0     1.42     1.33     1.06     1.00   8491 K     0.73     2.83     14 M     0.68     4.67     7.50     71 M     4.00     0.60      N/A</div><div class="line">   2    0     1.41     1.33     1.06     1.00   8206 K     0.74     2.75     12 M     0.72     4.25     7.00     71 M     4.00     0.60      N/A</div><div class="line">   3    0     1.46     1.38     1.06     1.00   7464 K     0.75     2.40     11 M     0.68     3.81     6.21     71 M     4.00     0.60      N/A</div><div class="line">   4    0     1.31     1.24     1.06     1.00   9118 K     0.71     3.28     15 M     0.69     5.61     8.88     70 M     4.00     0.61      N/A</div><div class="line">   5    0     1.41     1.33     1.06     1.00   8700 K     0.74     2.92     13 M     0.69     4.66     7.57     70 M     4.00     0.61      N/A</div><div class="line">   6    0     1.41     1.33     1.06     1.00   8094 K     0.74     2.79     12 M     0.70     4.40     7.18     70 M     4.00     0.61      N/A</div><div class="line">   7    0     1.43     1.35     1.06     1.00   7873 K     0.74     2.68     12 M     0.71     4.13     6.81     70 M     4.00     0.61      N/A</div><div class="line">   8    0     1.44     1.36     1.06     1.00   8544 K     0.73     2.79     14 M     0.67     4.87     7.66     20 M     1.00     0.61      N/A</div><div class="line">   9    0     1.24     1.16     1.06     1.00    524 K     0.51     0.21     86 K     0.94     0.03     0.24     20 M     1.00     0.61      N/A</div><div class="line">  10    0     1.26     1.18     1.07     1.00    379 K     0.50     0.15     60 K     0.95     0.02     0.17     20 M     1.00     0.61      N/A</div><div class="line">  11    0     1.24     1.16     1.07     1.00    533 K     0.50     0.20     96 K     0.94     0.04     0.24     20 M     1.00     0.61      N/A</div><div class="line">  12    0     1.22     1.14     1.07     1.00   1180 K     0.34     0.47     98 K     0.94     0.04     0.51   3872 K     0.12     0.46      N/A</div><div class="line">  13    0     1.24     1.16     1.07     1.00    409 K     0.49     0.16     64 K     0.94     0.03     0.19   3872 K     0.12     0.46      N/A</div><div class="line">  </div><div class="line">  ---------------------------------------------------------------------------------------------------------------</div><div class="line"> SKT    0     1.18     1.11     1.06     1.00    113 M     0.67     0.73    139 M     0.71     0.89     1.62    186 M     1.12     0.59      N/A</div><div class="line"> SKT    1     1.23     1.14     1.08     1.00     33 M     0.53     0.21     11 M     0.89     0.07     0.28     38 M     0.12     0.45      N/A</div><div class="line">---------------------------------------------------------------------------------------------------------------</div><div class="line"> TOTAL  *     1.21     1.13     1.07     1.00    147 M     0.65     0.46    150 M     0.74     0.47     0.93    224 M     0.62     0.57     N/A</div><div class="line"></div><div class="line"> Instructions retired:  319 G ; Active cycles:  283 G ; Time (TSC): 2108 Mticks ; C0 (active,non-halted) core residency: 107.12 %</div><div class="line"></div><div class="line"></div><div class="line"> PHYSICAL CORE IPC                 : 2.25 =&gt; corresponds to 32.18 % utilization for cores in active state</div><div class="line"> Instructions per nominal CPU cycle: 2.41 =&gt; corresponds to 34.48 % core utilization over time interval</div><div class="line">---------------------------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">Cleaning up</div><div class="line"> Zeroed PMU registers</div></pre></td></tr></table></figure>
<h2 id="Apple-M1"><a href="#Apple-M1" class="headerlink" title="Apple M1"></a>Apple M1</h2><p><img src="/images/951413iMgBlog/image-20220402101632476.png" alt="M1, M1 Pro, and M1 Max chips are shown next to each other." style="zoom:50%;"></p>
<h3 id="The-M1"><a href="#The-M1" class="headerlink" title="The M1"></a><strong>The M1</strong></h3><p>The critically-acclaimed M1 processor delivers:</p>
<ul>
<li>16 billion transistors and a 119mm squared-die size.</li>
<li>4 performance cores, 12MB L2 Cache.</li>
<li>4 efficiency cores ith 4MB L2 cache.</li>
<li>8 GPU Cores.</li>
<li>16GB DDR4x memory at 68GB/s.</li>
</ul>
<h3 id="The-M1-Pro"><a href="#The-M1-Pro" class="headerlink" title="The M1 Pro"></a><strong>The M1 Pro</strong></h3><p>The M1 Pro takes this higher, with:</p>
<ul>
<li>33.7 billion transistors on a 240mm squared die.</li>
<li>8 performance cores, 24MB L2 Cache.</li>
<li>2 efficiency cores with 4MB L2 cache.</li>
<li>16 GPU Cores.</li>
<li>32GB DDR5 memory at 200GB/s.</li>
</ul>
<p>对比下 i9-12000，i9也有GPU只是没有说多少个，它的GPU频率在0.3到1.55GHz之间</p>
<p><img src="/images/951413iMgBlog/400px-alder_lake_die_2.png" alt="alder lake die 2.png"></p>
<table>
<thead>
<tr>
<th>ISA</th>
<th>x86-64 (x86)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Microarchitecture</td>
<td><a href="https://en.wikichip.org/wiki/intel/microarchitectures/alder_lake" target="_blank" rel="external">Alder Lake</a>, <a href="https://en.wikichip.org/wiki/intel/microarchitectures/golden_cove" target="_blank" rel="external">Golden Cove</a>, <a href="https://en.wikichip.org/wiki/intel/microarchitectures/gracemont" target="_blank" rel="external">Gracemont</a></td>
</tr>
<tr>
<td>Process</td>
<td><a href="https://en.wikichip.org/w/index.php?title=Intel_7_process&amp;action=edit&amp;redlink=1" target="_blank" rel="external">Intel 7</a></td>
</tr>
<tr>
<td>Die</td>
<td>215.25 mm²” 20.5 mm × 10.5 mm</td>
</tr>
<tr>
<td>MCP</td>
<td>No (1 dies)</td>
</tr>
<tr>
<td>Cores</td>
<td>16</td>
</tr>
<tr>
<td>Threads</td>
<td>24</td>
</tr>
<tr>
<td><a href="https://en.wikichip.org/wiki/Property:l1$_size" target="_blank" rel="external">l1$ size</a></td>
<td>0.75 MiB (768 KiB, 786,432 B, 7.324219e-4 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l1-24-20size/0.75-20MiB" target="_blank" rel="external">+</a> and 0.625 MiB (640 KiB, 655,360 B, 6.103516e-4 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l1-24-20size/0.625-20MiB" target="_blank" rel="external">+</a></td>
</tr>
<tr>
<td><a href="https://en.wikichip.org/wiki/Property:l1d$_size" target="_blank" rel="external">l1d$ size</a></td>
<td>0.25 MiB (256 KiB, 262,144 B, 2.441406e-4 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l1d-24-20size/0.25-20MiB" target="_blank" rel="external">+</a> and 0.375 MiB (384 KiB, 393,216 B, 3.662109e-4 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l1d-24-20size/0.375-20MiB" target="_blank" rel="external">+</a></td>
</tr>
<tr>
<td><a href="https://en.wikichip.org/wiki/Property:l1i$_size" target="_blank" rel="external">l1i$ size</a></td>
<td>0.5 MiB (512 KiB, 524,288 B, 4.882812e-4 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l1i-24-20size/0.5-20MiB" target="_blank" rel="external">+</a> and 0.25 MiB (256 KiB, 262,144 B, 2.441406e-4 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l1i-24-20size/0.25-20MiB" target="_blank" rel="external">+</a></td>
</tr>
<tr>
<td><a href="https://en.wikichip.org/wiki/Property:l2$_size" target="_blank" rel="external">l2$ size</a></td>
<td>4 MiB (4,096 KiB, 4,194,304 B, 0.00391 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l2-24-20size/4-20MiB" target="_blank" rel="external">+</a> and 10 MiB (10,240 KiB, 10,485,760 B, 0.00977 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l2-24-20size/10-20MiB" target="_blank" rel="external">+</a></td>
</tr>
<tr>
<td><a href="https://en.wikichip.org/wiki/Property:l3$_size" target="_blank" rel="external">l3$ size</a></td>
<td>6 MiB (6,144 KiB, 6,291,456 B, 0.00586 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l3-24-20size/6-20MiB" target="_blank" rel="external">+</a> and 24 MiB (24,576 KiB, 25,165,824 B, 0.0234 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l3-24-20size/24-20MiB" target="_blank" rel="external">+</a></td>
</tr>
</tbody>
</table>
<h3 id="The-M1-Max"><a href="#The-M1-Max" class="headerlink" title="The M1 Max"></a><strong>The M1 Max</strong></h3><p>The M1 Max provides:</p>
<ul>
<li>57 billion transistors on a 420mm squared die.</li>
<li>8 performance cores, 24MB L2 Cache.</li>
<li>2 efficiency cores with 4MB L2 cache.</li>
<li>32 GPU Cores.</li>
<li>64GB DDR5 memory at 400GB/s.</li>
</ul>
<h3 id="And-the-new-M1-Ultra"><a href="#And-the-new-M1-Ultra" class="headerlink" title="And the new M1 Ultra"></a><strong>And the new M1 Ultra</strong></h3><p>The M1 Ultra brings you:</p>
<ul>
<li>114 billion transistors on a 840mm squared die.</li>
<li>16 performance cores, 48MB L2 Cache.</li>
<li>4 efficiency cores with 4MB L2 cache.</li>
<li>64 GPU Cores.</li>
<li>Up to 128GB DDR5 memory at 800GB/s.</li>
</ul>
<h2 id="倚天710"><a href="#倚天710" class="headerlink" title="倚天710"></a>倚天710</h2><p>一个die有64core，每两个core是一个cluster，一块cpu封装两个die</p>
<p>一个die大小是314平方毫米，600亿晶体管</p>
<p><img src="/images/951413iMgBlog/image-20211205130348832.png" alt="image-20211205130348832"></p>
<p>平头哥的几款芯片：</p>
<p><img src="/images/951413iMgBlog/v2-4a587237e30986b36c5657761c31ae21_r.jpg" alt="preview"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>AMD和Intel在服务器领域CPU设计上走了两个不同的方向，Intel通过RingBus、Mesh等方案在一块Die上集成多个core，成本高，在多核场景下性能好。</p>
<p>AMD则是通过设计小的Die来降低成本，然后将多个Die封装到一块CPU上来售卖，Zen1架构的多个Die之间延迟高，于是Zen2将IO抽离出来用一块单独的IO Die来负责IO，这样多核之间的时延比Zen1好了很多。</p>
<p>而在云计算场景下AMD的设计非常有竞争优势，因为云计算大部分时候是要把一块大的CPU分拆售卖，从架构上AMD对分拆售卖非常友好。</p>
<p>整体来说AMD用领先了一代的工艺（7nm VS 14nm)，在MySQL查询场景中终于可以接近Intel了，但是海光、鲲鹏、飞腾还是不给力。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="/2021/06/01/CPU的制造和概念/">CPU的制造和概念</a></p>
<p><a href="/2021/05/16/CPU Cache Line 和性能/">CPU 性能和Cache Line</a></p>
<p><a href="/2021/05/16/Perf IPC以及CPU利用率/">Perf IPC以及CPU性能</a></p>
<p><a href="/2021/06/18/几款CPU性能对比/">Intel、海光、鲲鹏920、飞腾2500 CPU性能对比</a></p>
<p><a href="/2021/05/15/飞腾ARM芯片(FT2500">飞腾ARM芯片(FT2500)的性能测试</a>的性能测试/)</p>
<p><a href="/2021/05/14/十年后数据库还是不敢拥抱NUMA/">十年后数据库还是不敢拥抱NUMA？</a></p>
<p><a href="/2021/03/07/一次海光物理机资源竞争压测的记录/">一次海光物理机资源竞争压测的记录</a></p>
<p><a href="/2019/12/16/Intel PAUSE指令变化是如何影响自旋锁以及MySQL的性能的/">Intel PAUSE指令变化是如何影响自旋锁以及MySQL的性能的</a></p>
<p><a href="https://blog.csdn.net/xuanjian_bjtu/article/details/107178226" target="_blank" rel="external">lmbench测试要考虑cache等</a> </p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/海光/" rel="tag"># 海光</a>
          
            <a href="/tags/超线程/" rel="tag"># 超线程</a>
          
            <a href="/tags/ADM/" rel="tag"># ADM</a>
          
            <a href="/tags/Zen/" rel="tag"># Zen</a>
          
            <a href="/tags/hygon/" rel="tag"># hygon</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/07/19/CPU性能和CACHE/" rel="next" title="CPU性能和CACHE">
                <i class="fa fa-chevron-left"></i> CPU性能和CACHE
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/11/26/数据库计算向量化/" rel="prev" title="数据库计算向量化">
                数据库计算向量化 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="twitter @plantegg" />
          <p class="site-author-name" itemprop="name">twitter @plantegg</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">176</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">22</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">270</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#AMD-Zen-CPU-架构"><span class="nav-number">1.</span> <span class="nav-text">AMD Zen CPU 架构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AMD-EPYC-CPU演进路线"><span class="nav-number">1.2.</span> <span class="nav-text">AMD EPYC CPU演进路线</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Zen1"><span class="nav-number">1.3.</span> <span class="nav-text">Zen1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Zen1-Die"><span class="nav-number">1.3.1.</span> <span class="nav-text">Zen1 Die</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Zen-CPU-Complex-CCX"><span class="nav-number">1.3.2.</span> <span class="nav-text">Zen CPU Complex(CCX)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#封装后的Zen1（4Die）"><span class="nav-number">1.3.3.</span> <span class="nav-text">封装后的Zen1（4Die）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Zen2-Rome"><span class="nav-number">1.4.</span> <span class="nav-text">Zen2 Rome</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Zen2-Core-Complex-Die"><span class="nav-number">1.4.1.</span> <span class="nav-text">Zen2 Core Complex Die</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Zen1-VS-Zen2"><span class="nav-number">1.5.</span> <span class="nav-text">Zen1 VS Zen2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hygon-7280-PCM数据"><span class="nav-number">1.6.</span> <span class="nav-text">hygon 7280 PCM数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Apple-M1"><span class="nav-number">1.7.</span> <span class="nav-text">Apple M1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#The-M1"><span class="nav-number">1.7.1.</span> <span class="nav-text">The M1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-M1-Pro"><span class="nav-number">1.7.2.</span> <span class="nav-text">The M1 Pro</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-M1-Max"><span class="nav-number">1.7.3.</span> <span class="nav-text">The M1 Max</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#And-the-new-M1-Ultra"><span class="nav-number">1.7.4.</span> <span class="nav-text">And the new M1 Ultra</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#倚天710"><span class="nav-number">1.8.</span> <span class="nav-text">倚天710</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">1.9.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料"><span class="nav-number">1.10.</span> <span class="nav-text">参考资料</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">twitter @plantegg</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv_footer"></span>次
</span>
<span id="busuanzi_container_site_uv">
  本站访客数<span id="busuanzi_value_site_uv_footer"></span>人次
</span>


        
<div class="busuanzi-count">
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  

  

</body>
</html>
